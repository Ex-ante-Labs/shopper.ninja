<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="firebase-ui-styles.html">
<link rel="import" href="shopper-facebook.html">
<script src="https://www.gstatic.com/firebasejs/ui/live/0.4/firebase-ui-auth.js"></script>

<dom-module id="shopper-auth">
  <template>
    <style include="firebase-ui-styles">
      :host {
        display: block;
        height: 100%;
        @apply(--layout);
        @apply(--layout-center);
        @apply(--layout-center-justified);
        /*background-color: lightPink;*/
      }

      #container {
        width: 100%;
        /*background-color: lightGreen;*/
      }
    </style>
    <firebase-auth id="auth" user="{{user}}" on-status-known-changed="_startUi"></firebase-auth>
    <div id="container"></div>
    <shopper-facebook app-id="1729227607329104"></shopper-facebook>
  </template>
  <script>
    Polymer({
      is: 'shopper-auth',
      ready: function() {
        this.scopeSubtree(this.$.container, true);
      },
      _startUi: function(e, statusKnown) {
        if (statusKnown.value) {
          var facebook = new firebase.auth.FacebookAuthProvider();
          facebook.addScope('public_profile');
          facebook.addScope('email');
          facebook.addScope('user_friends');
          // FirebaseUI config.
          var uiConfig = {
            'signInSuccessUrl': '/list',
            'signInOptions': [
              // Leave the lines as is for the providers you want to offer your users.
              // firebase.auth.GoogleAuthProvider.PROVIDER_ID,
              facebook,
              // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
              // firebase.auth.GithubAuthProvider.PROVIDER_ID,
              firebase.auth.EmailAuthProvider.PROVIDER_ID
            ],
            // Terms of service url.
            'tosUrl': '/tos',
            'callbacks': {
              'signInSuccess': function(currentUser, credential, redirectUrl) {
                FB.api('/me/friends', {
                  access_token: credential.accessToken
                }, function(response) {
                  console.log(JSON.stringify(response, null, '  '));
                });
                return false;
              }
            }
          };

          // Initialize the FirebaseUI Widget using Firebase.
          var ui = new firebaseui.auth.AuthUI(this.$.auth.auth);
          // The start method will wait until the DOM is loaded.
          ui.start(this.$.container, uiConfig);
        }
      }
    });
  </script>
</dom-module>
